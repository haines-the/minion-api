<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      function init() {
        function debug(string) {
          var element = document.getElementById("debug");
          var p = document.createElement("p");
          p.appendChild(document.createTextNode(string));
          element.appendChild(p);
        }

        // Start with creating a command and retrieving the command ID.
        var server_id = 'abc123'

        // Be sure you specify ALL of these when sending a post, otherwise
        // the request will fail somewhat silently.
        var command = {
          server_id: server_id,
          command: '/tmp/infinity',
          user_id: 'abcdef',
          stderr: [],
          stdout: [],
          created_at: null,
          started_at: null,
          completed_at: null
        }

        var id;

        axios.post('http://localhost:9292/commands', command,
        {
          headers: [
            {'Content-Type':'application/json'}
            // {'Access-Control-Request-Method': 'POST'}
            // {'Access-Control-Request-Header': ''}
          ]
        })
        .then(function (response) {
          console.log(response);
          id = response.data.id;
        })
        .catch(function (error) {
          console.log(error);
        });

        var Socket = "MozWebSocket" in window ? MozWebSocket : WebSocket;
        var ws = new Socket("ws://localhost:9000/command");
        ws.onmessage = function(evt) {
           debug("Received: " + evt.data);
        };

        ws.onclose = function(event) {
          debug("Closed - code: " + event.code + ", reason: " + event.reason + ", wasClean: " + event.wasClean);
        };

        ws.onopen = function() {
          debug("connected...");
          ws.send('{ "action":"output_command", "command_id":"' + id + '"}')
        };
      };
    </script>
  </head>
  <body onload="init();">
    <div id="debug"></div>
  </body>
</html>

<!-- In another websocket client, paste this to get the above to update: -->
<!-- {"action":"update_command","command_id":"c541ba89-9df0-469f-8d27-a5c2ae9d255b" },"server_id":"abc123","stdout": [{"output":"asdf hello world", "at":"2020-05-24 21:24:39 +0000"}],"stderr": [{"output": "oh noes stderr!", "at":"2020-05-24 21:24:39 +0000" }]} -->
